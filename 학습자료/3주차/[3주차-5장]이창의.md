# 5ì¥ ì—°ê´€ê´€ê³„ ë§¤í•‘

ê°ì²´ ê´€ê³„ ë§¤í•‘, ORMì—ì„œ ê°€ì¥ ì–´ë ¤ìš´ ë¶€ë¶„ì´ ë°”ë¡œ ê°ì²´ ì—°ê´€ê´€ê³„ì™€ í…Œì´ë¸” ì—°ê´€ê´€ê³„ë¥¼ ë§¤í•‘í•˜ëŠ” ì¼ì´ë‹¤.

> ì´ ì¥ì—ì„œëŠ” ê°ì²´ì˜ ì°¸ì¡°ì™€ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¥¼ ë§¤í•‘í•˜ëŠ” ê²ƒì„ ë°°ìš¸ ê²ƒì´ë‹¤.
> 

### ì´ ì¥ì˜ í•µì‹¬ í‚¤ì›Œë“œ

- ë°©í–¥, direction : ë‹¨ë°©í–¥ê³¼ ì–‘ë°©í–¥ì´ ì¡´ì¬í•œë‹¤.
    - íšŒì›ê³¼ íŒ€ì´ ê´€ê³„ê°€ ìˆì„ ë•Œ, íšŒì› â†’ íŒ€ ë˜ëŠ” íŒ€ â†’ íšŒì› ì²˜ëŸ¼ í•œ ìª½ìœ¼ë¡œ ì°¸ì¡°í•˜ëŠ” ê²ƒì„ ë‹¨ë°©í–¥ ê´€ê³„ë¼ê³  í•˜ê³  ì–‘ìª½ ëª¨ë‘ ì„œë¡œ ì°¸ì¡°í•˜ëŠ” ê²ƒì„ ì–‘ë°©í–¥ ê´€ê³„ë¼ê³  í•œë‹¤.
    - ë°©í–¥ì€ ê°ì²´ì˜ ê´€ì ì—ì„œ ë³´ì•˜ì„ ë•Œë§Œ ì¡´ì¬í•˜ê³  í…Œì´ë¸”ì€ í•­ìƒ ì–‘ë°©í–¥ ê´€ê³„ë§Œ ì¡´ì¬í•œë‹¤.
- ë‹¤ì¤‘ì„±, multiplicity : ë‹¤ëŒ€ì¼, ì¼ëŒ€ë‹¤, ì¼ëŒ€ì¼, ë‹¤ëŒ€ë‹¤ ë‹¤ì¤‘ì„±ì´ ìˆë‹¤.
    - íšŒì›ê³¼ íŒ€ì´ ê´€ê³„ê°€ ìˆì„ ë•Œ ì—¬ëŸ¬ íšŒì›ì€ í•œ íŒ€ì— ì†í•˜ë¯€ë¡œ íšŒì›ê³¼ íŒ€ì€ ë‹¤ëŒ€ì¼ ê´€ê³„ë‹¤.
    - ë°˜ëŒ€ë¡œ í•œ íŒ€ì— ì—¬ëŸ¬ íšŒì›ì´ ì†Œì†ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ íŒ€ê³¼ íšŒì›ì€ ì¼ëŒ€ë‹¤ ê´€ê³„ë‹¤.
- ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸, onwer : ê°ì²´ë¥¼ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¡œ ë§Œë“¤ë©´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì„ ì •í•´ì•¼ë§Œ í•œë‹¤.

# 5.1 ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„

## ë‹¤ëŒ€ì¼ ì—°ê´€ê´€ê³„

- íšŒì›ì€ íŒ€ì´ í•˜ë‚˜ ì¡´ì¬í•˜ë©° í•˜ë‚˜ì— íŒ€ì—ë§Œ ì¡´ì¬í•  ìˆ˜ ìˆë‹¤. ì¦‰, íšŒì›ê³¼ íŒ€ì€ ë‹¤ëŒ€ì¼ ê´€ê³„ì´ë‹¤.

### ê°ì²´ ì—°ê´€ê´€ê³„

> íšŒì› ê°ì²´ëŠ” [Member.team](http://Member.team) í•„ë“œë¡œ íŒ€ ê°ì²´ì™€ ì—°ê´€ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤.
> 
- íšŒì› ê°ì²´ì™€ íŒ€ ê°ì²´ëŠ” ë‹¨ë°©í–¥ ê´€ê³„ì´ê¸° ë•Œë¬¸ì— [Member.team](http://Member.team) í•„ë“œë¥¼ í†µí•´ì„œ íŒ€ì„ ì°¸ì¡°í•  ìˆ˜ ìˆì§€ë§Œ ë°˜ëŒ€ë¡œ íŒ€ì€ íšŒì›ì„ ì°¸ì¡°í•  ìˆ˜ ì—†ë‹¤.
- member.getTeam()ì€ ê°€ëŠ¥í•˜ì§€ë§Œ team.getMembers()ëŠ” ë¶ˆê°€ëŠ¥í•˜ë‹¤.

### í…Œì´ë¸” ì—°ê´€ê´€ê³„

> íšŒì› í…Œì´ë¸”ì€ TEAM_ID ì™¸ë˜ í‚¤ë¡œ íŒ€ í…Œì´ë¸”ê³¼ ì—°ê´€ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤.
> 
- íšŒì› í…Œì´ë¸”ê³¼ íŒ€ í…Œì´ë¸”ì€ ì–‘ë°©í–¥ ê´€ê³„ì´ê¸° ë•Œë¬¸ì— íšŒì› í…Œì´ë¸”ì˜ TEAM_ID ì™¸ë˜ í‚¤ë¥¼ í†µí•´ì„œ íšŒì›ê³¼ íŒ€ì„ ì¡°ì¸í•  ìˆ˜ ìˆê³  ë°˜ëŒ€ë¡œ íŒ€ê³¼ íšŒì›ë„ ì¡°ì¸í•  ìˆ˜ ìˆë‹¤.

```sql
SELECT *
FROM MEMBER JOIN TEAM
ON MEMBER.TEAM_ID = TEAM.TEAM_ID
```

```sql
SELECT *
FROM TEAM JOIN MEMBER
ON TEAM.TEAM_ID = MEMBER.TEAM_ID
```

### ê°ì²´ ì—°ê´€ê´€ê³„ì™€ í…Œì´ë¸” ì—°ê´€ê´€ê³„ì˜ ê°€ì¥ í° ì°¨ì´

ì°¸ì¡°ë¥¼ í†µí•œ ì—°ê´€ê´€ê³„ëŠ” í•­ìƒ ë‹¨ë°©í–¥ì´ê¸° ë•Œë¬¸ì— ê°ì²´ë¥¼ ì–‘ë°©í–¥ìœ¼ë¡œ ë§Œë“¤ê³  ì‹¶ë‹¤ë©´ ì–‘ìª½ì—ì„œ ë‹¨ë°©í–¥ ê´€ê³„ì¸ í•„ë“œë¥¼ ì¶”ê°€í•´ì„œ ì°¸ì¡°ë¥¼ ë³´ê´€í•´ì£¼ì–´ì•¼ í•œë‹¤.

```java
class A{ B b; } 
class B{ }
```

```java
class A{ B b; }
class B{ A a; }
```

ë°˜ë©´ í…Œì´ë¸”ì€ ì™¸ë˜ í‚¤ í•˜ë‚˜ë¡œ ì–‘ë°©í–¥ ì¡°ì¸ì´ ê°€ëŠ¥í•˜ë‹¤.

### ê°ì²´ ì—°ê´€ê´€ê³„ vs í…Œì´ë¸” ì—°ê´€ê´€ê³„

- ê°ì²´ëŠ” ì°¸ì¡°ë¥¼ í†µí•´ ì—°ê´€ê´€ê³„ë¥¼ ë§ºê³  ì°¸ì¡°ë¥¼ í†µí•œ ì—°ê´€ê´€ê³„ëŠ” í•­ìƒ ë‹¨ë°©í–¥ì´ë‹¤. (ì–‘ë°©í–¥ì€ ë‹¨ë°©í–¥ ë‘ê°œ)
- í…Œì´ë¸”ì€ ì™¸ë˜ í‚¤ë¡œ ì—°ê´€ê´€ê³„ë¥¼ ë§ºê³  ì™¸ë˜ í‚¤ë¥¼ í†µí•œ ì—°ê´€ê´€ê³„ëŠ” í•­ìƒ ì–‘ë°©í–¥ì´ë‹¤.

## 5.1.1 ìˆœìˆ˜í•œ ê°ì²´ ì—°ê´€ê´€ê³„

ë‹¤ìŒì˜ ì½”ë“œëŠ” JPAë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì€ ìˆœìˆ˜í•œ íšŒì›ê³¼ íŒ€ í´ë˜ìŠ¤ì˜ ì½”ë“œë‹¤.

```java
public class Member{

		private String id;
		private String username;
		
		private Team team;
		
		// Getter, Setter ...
}

public class Team{
		private String id;
		private String name;
		
		// Getter, Setter ...
}
```

```java
Member member1 = new Member("member1", "íšŒì›1");
Member member1 = new Member("member2", "íšŒì›2");
Team team1 = new Team("team1", "íŒ€1");

member1.setTeam(team1);
member2.setTeam(team1);

Team findTeam = member1.getTeam();
```

íšŒì›1ê³¼ íšŒì› 2ëŠ” íŒ€1ì— ì†Œì†ë˜ì–´ ìˆë‹¤. íšŒì›1ì€ getTeam() ë©”ì„œë“œë¥¼ í†µí•´ì„œ íŒ€1ì„ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.

> ê°ì²´ëŠ” ì°¸ì¡°ë¥¼ ì‚¬ìš©í•´ì„œ ì—°ê´€ê´€ê³„ë¥¼ íƒìƒ‰í•˜ëŠ”ë° ì´ê²ƒì„ ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ì´ë¼ê³  í•œë‹¤.
> 

## 5.1.2 í…Œì´ë¸” ì—°ê´€ê´€ê³„

ë‹¤ìŒì˜ ì½”ë“œëŠ” íšŒì› í…Œì´ë¸”ê³¼ íŒ€ í…Œì´ë¸”ì˜ DDL ì´ë©° TEAM_IDì— ì™¸ë˜ í‚¤ ì œì•½ ì¡°ê±´ì„ ì„¤ì •í–ˆë‹¤.

```sql
CREATE TABLE MEMBER{
	MEMBER_ID VARCHAR(255) NOT NULL,
	TEAM_ID VARCHAR(255),
	USERNAME VARCHAR(255),
	PRIMARY KEY (MEMBER_ID)
}

CREATE TABLE TEAM{
	TEAM_ID VARCHAR(255) NOT NULL,
	NAME VARCHAR(255),
	PRIMARY KEY (TEAM_ID)
}

ALTER TABLE MEMBER ADD CONSTRAINT FK_MEMBER_TEAM
	FOREIGN KEY (TEAM_ID)
	REFERENCES TEAM
```

íšŒì›1ê³¼ íšŒì›2ë¥¼ íŒ€1ì— ì†Œì†ì‹œí‚¨ë‹¤.

```sql
INSERT INTO TEAM VALUES('team1', 'íŒ€1');
INSERT INTO MEMBER VALUES('member1', 'team1', 'íšŒì›1');
INSERT INTO MEMBER VALUES('member2', 'team1', 'íšŒì›2');
```

ë‹¤ìŒ SQL ë¬¸ì„ í†µí•´ íŒ€ì„ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.

```sql
SELECT T.*
FROM MEMBER JOIN TEAM
ON MEMBER.TEAM_ID = TEAM.TEAM_ID
WHERE MEMBER.MEMBER_ID = 'member1'
```

> ì´ì²˜ëŸ¼ ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì™¸ë˜ í‚¤ë¥¼ ì‚¬ìš©í•´ì„œ ì—°ê´€ê´€ê³„ë¥¼ íƒìƒ‰í•  ìˆ˜ ìˆëŠ”ë° ì´ê²ƒì„ ì¡°ì¸ì´ë¼ í•œë‹¤.
> 

## 5.1.3 ê°ì²´ ê´€ê³„ ë§¤í•‘

```java
@Entity
public class Member{

		@Id @Column(name = "MEMBER_ID")
		private String id;
		
		private String username;
		
		@ManyToOne
		@JoinColumn(name="TEAM_ID")
		private Team team;
		
		// Getter, Setter ...
}

@Entity
public class Team{
		
		@Id @Column(name = "TEAM_ID")
		private String id;
		private String name;
		
		// Getter, Setter ...
}
```

- @ManyToOne : ì´ë¦„ ê·¸ëŒ€ë¡œ ë‹¤ëŒ€ì¼ ê´€ê³„ë¼ëŠ” ë§¤í•‘ ì •ë³´ë‹¤.
    - íšŒì›ê³¼ íŒ€ì€ ë‹¤ëŒ€ì¼ ê´€ê³„ë‹¤. (íšŒì› ê´€ì )
- @JoinColumn (name=â€TEAM_IDâ€) : ì¡°ì¸ ì»¬ëŸ¼ì€ ì™¸ë˜ í‚¤ë¥¼ ë§¤í•‘í•  ë•Œ ì‚¬ìš©í•œë‹¤.
    - name ì†ì„±ì—ëŠ” ë§¤í•‘í•  ì™¸ë˜ í‚¤ ì´ë¦„ì„ ì§€ì •í•œë‹¤.
    - íšŒì›ê³¼ íŒ€ í…Œì´ë¸”ì€ TEAM_ID ì™¸ë˜ í‚¤ë¡œ ì—°ê´€ê´€ê³„ë¥¼ ë§ºìœ¼ë¯€ë¡œ ì´ ê°’ì„ ì§€ì •í•˜ë©´ ëœë‹¤.
    - ì´ ì–´ë…¸í…Œì´ì…˜ì€ ìƒëµì´ ê°€ëŠ¥í•˜ë‹¤.

## 5.1.4 @JoinColumn

> @JoinColumnì€ ì™¸ë˜ í‚¤ë¥¼ ë§¤í•‘í•  ë•Œ ì‚¬ìš©í•œë‹¤.
> 
- name : ë§¤í•‘í•  ì™¸ë˜ í‚¤ ì´ë¦„ì´ë‹¤.
    - í•„ë“œëª… + _ + ì°¸ì¡°í•˜ëŠ” í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ ì»¬ëŸ¼ëª… (ê¸°ë³¸ê°’)
- referencedColumnName : ì™¸ë˜ í‚¤ê°€ ì°¸ì¡°í•˜ëŠ” ëŒ€ìƒ í…Œì´ë¸”ì˜ ì»¬ëŸ¼ ëª…
    - ì°¸ì¡°í•˜ëŠ” í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ ì»¬ëŸ¼ëª… (ê¸°ë³¸ê°’)
- unique, nullable, insertable, updatable, columnDefinition, table
    - @Columnì˜ ê°’ê³¼ ê°™ë‹¤.

## 5.1.5 @ManyToOne

> @ManyToOne ì–´ë…¸í…Œì´ì…˜ì€ ë‹¤ëŒ€ì¼ ê´€ê³„ì—ì„œ ì‚¬ìš©í•œë‹¤.
> 
- optional : falseë¡œ ì„¤ì •í•˜ë©´ ì—°ê´€ëœ ì—”í‹°í‹°ê°€ í•­ìƒ ìˆì–´ì•¼ í•œë‹¤.
    - true (ê¸°ë³¸ê°’)
- fetch : ê¸€ë¡œë²Œ í˜ì¹˜ ì „ëµì„ ì„¤ì •í•œë‹¤.
    - FetchType.EAGER, FetchType.LAZY
- cascade : ì˜ì†ì„± ì „ì´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•œë‹¤.
- targetEntity : ì—°ê´€ëœ ì—”í‹°í‹°ì˜ íƒ€ì… ì •ë³´ë¥¼ ì„¤ì •í•œë‹¤.
    - ì´ ê¸°ëŠ¥ì€ ê±°ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
    - ì»¬ë ‰ì…˜ì„ ì‚¬ìš©í•˜ë”ë¼ë„ ì œë„¤ë¦­ìœ¼ë¡œ íƒ€ì… ì •ë³´ë¥¼ ì•Œ ìˆ˜ ìˆë‹¤.

# 5.2 ì—°ê´€ê´€ê³„ ì‚¬ìš©

## 5.2.1 ì €ì¥

```java
public void testSave(){
		Team team1 = new Team("team1", "íŒ€1");
		em.persist(team1);
		
		Member member1 = new Member("member1", "íšŒì›1");
		member1.setTeam(team1);
		em.persist(member1);
				
		Member member2 = new Member("member2", "íšŒì›2");
		member1.setTeam(team1);
		em.persist(member2);

}
```

JPAëŠ” ì°¸ì¡°í•œ íŒ€ì˜ ì‹ë³„ìë¥¼ ì™¸ë˜ í‚¤ë¡œ ì‚¬ìš©í•´ì„œ ì ì ˆí•œ ë“±ë¡ ì¿¼ë¦¬ë¥¼ ìƒì„±í•œë‹¤. 

```sql
INSERT INTO TEAM VALUES('team1', 'íŒ€1');
INSERT INTO MEMBER VALUES('member1', 'team1', 'íšŒì›1');
INSERT INTO MEMBER VALUES('member2', 'team1', 'íšŒì›2');
```

## 5.2.2 ì¡°íšŒ

> ì—°ê´€ê´€ê³„ê°€ ìˆëŠ” ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ëŠ” ë°©ë²•ì€ í¬ê²Œ 2ê°€ì§€ê°€ ìˆë‹¤.
ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ (ê°ì²´ì˜ ì—°ê´€ê´€ê³„ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¡°íšŒ), ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì‚¬ìš© JPQL
> 
1. ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰

```java
Member member = em.find(Member.class, "member1");
Team team = member.getTeam(); // ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰
```

1. JPQL

```java
String jpql = "SELECT m FROM MEMBER m JOIN m.TEAM t WHERE" +
		"t.NAME=:teamName";
		
List<Member> resultList = em.createquery(jpql, Member.class)
		.setParameter("teamName", "íŒ€1")
		.getResultList();
```

:ë¡œ ì‹œì‘í•˜ëŠ” ê²ƒì€ íŒŒë¼ë¯¸í„°ë¥¼ ë°”ì¸ë”© ë°›ëŠ” ë¬¸ë²•ì´ë‹¤.

```sql
SELECT M.*
FROM MEMBER INNER JOIN TEAM
ON MEMBER.TEAM_ID = TEAM.TEAM_ID
WHERE TEAM.NAME = 'íŒ€1'
```

JPQLì€ ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•˜ê³  SQLë³´ë‹¤ ê°„ê²°í•˜ë‹¤.

## 5.2.3 ìˆ˜ì •

```java
Team team2 = new Team("team2", "íŒ€2");
em.persist(team2);

Member member = em.find(Member.class, "member1");
member.setTeam(team2);
```

ë‹¨ìˆœíˆ ë¶ˆëŸ¬ì˜¨ ì—”í‹°í‹°ì˜ ê°’ë§Œ ë³€ê²½í•´ë‘ë©´ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•  ë•Œ í”ŒëŸ¬ì‹œê°€ ì¼ì–´ë‚˜ë©´ì„œ ë³€ê²½ ê°ì§€ ê¸°ëŠ¥ì´ ì‘ë™í•œë‹¤.

ê·¸ë¦¬ê³  ë³€ê²½ ì‚¬í•­ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ìë™ìœ¼ë¡œ ë°˜ì˜í•œë‹¤.

> ì—°ê´€ê´€ê³„ë„ ë§ˆì°¬ê°€ì§€ë¡œ ì°¸ì¡°í•˜ëŠ” ëŒ€ìƒë§Œ ë³€ê²½í•˜ë©´ JPAê°€ ì•Œì•„ì„œ ì²˜ë¦¬í•œë‹¤.
> 

## 5.2.4 ì—°ê´€ê´€ê³„ ì œê±°

```java
Member member = em.find(Member.class, "member1");
member.setTeam(null); // ì—°ê´€ê´€ê³„ ì œê±°
```

## 5.2.5 ì—°ê´€ëœ ì—”í‹°í‹° ì‚­ì œ

> ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ ì‚­ì œí•˜ë ¤ë©´ ê¸°ì¡´ì— ìˆë˜ ì—°ê´€ê´€ê³„ë¥¼ ë¨¼ì € ì œê±°í•˜ê³  ì‚­ì œí•´ì•¼ í•œë‹¤.
ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ë°ì´í„°ë² ì´ìŠ¤ ì™¸ë˜ í‚¤ ì œì•½ì¡°ê±´ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.
> 

```java
member1.setTeam(null);
member2.setTeam(null);
em.remove(team);
```

# 5.3 ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„

íšŒì›ì—ì„œ íŒ€ìœ¼ë¡œ ì ‘ê·¼í•˜ê³  ë°˜ëŒ€ ë°©í–¥ì¸ íŒ€ì—ì„œë„ íšŒì›ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¡œ ë§¤í•‘í•´ë³´ì.

ì¼ëŒ€ë‹¤ ê´€ê³„ëŠ” ì—¬ëŸ¬ ê±´ê³¼ ì—°ê´€ê´€ê³„ë¥¼ ë§ºì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì»¬ë ‰ì…˜ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

<aside>
ğŸ™Œ JPAëŠ” Listë¿ë§Œ ì•„ë‹ˆë¼ Map, Collection, Set ê°™ì€ ë‹¤ì–‘í•œ ì»¬ë ‰ì…˜ì„ ì§€ì›í•œë‹¤.

</aside>

ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì€ ì™¸ë˜ í‚¤ í•˜ë‚˜ë¡œ ì–‘ë°©í–¥ìœ¼ë¡œ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.

ë”°ë¼ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ì¶”ê°€í•  ë‚´ìš©ì€ ì „í˜€ ì—†ë‹¤.

## 5.3.1 ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ ë§¤í•‘

```java
// MemberëŠ” ë³€ê²½ì‚¬í•­ ì—†ìŒ
@Entity
public class Member{

		@Id @Column(name = "MEMBER_ID")
		private String id;
		
		private String username;
		
		@ManyToOne
		@JoinColumn(name="TEAM_ID")
		private Team team;
		
		// Getter, Setter ...
}

@Entity
public class Team{
		
		@Id @Column(name = "TEAM_ID")
		private String id;
		
		private String name;
		
		@OneToMany(mappedBy = "team")
		private List<Member> members = new ArrayList<>();
		
		// Getter, Setter ...
}
```

- mappedBy ì†ì„±ì€ ì–‘ë°©í–¥ ë§¤í•‘ì¼ë•Œ ì‚¬ìš©í•˜ëŠ”ë° ë°˜ëŒ€ìª½ì— ë§¤í•‘ëœ í•„ë“œ ì´ë¦„ì„ ê°’ìœ¼ë¡œ ì£¼ë©´ ëœë‹¤.
- ë°˜ëŒ€ìª½ ë§¤í•‘ì´ [Member.team](http://Member.team)ì´ë¯€ë¡œ teamì„ ê°’ìœ¼ë¡œ ì£¼ì—ˆë‹¤. (getTeam())

## 5.3.2 ì¼ëŒ€ë‹¤ ì»¬ë ‰ì…˜ ì¡°íšŒ

```java
Team team = em.find(Team.class, "team1");
List<Member> members = team.getMembers();
// team -> member ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰
```

# 5.4 ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸

> ë‹¨ìˆœíˆ @OneToManyë§Œ ìˆìœ¼ë©´ ë˜ì§€ mappedByëŠ” ì™œ í•„ìš”í• ê¹Œ?
> 

ì•ì—ì„œë„ ë§í–ˆë“¯ì´ ì—„ë°€íˆ ì´ì•¼ê¸°í•˜ë©´ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¼ëŠ” ê²ƒì€ ì—†ë‹¤. 

ì„œë¡œ ë‹¤ë¥¸ ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ 2ê°œë¥¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ìœ¼ë¡œ ì˜ ë¬¶ì–´ì„œ ì–‘ë°©í–¥ì¸ ê²ƒì²˜ëŸ¼ ë³´ì´ê²Œ í•  ë¿ì´ë‹¤.

> ê·¸ë ‡ë‹¤ë©´ ë‘˜ ì¤‘ ì–´ë–¤ ê´€ê³„ë¥¼ ì‚¬ìš©í•´ì„œ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•´ì•¼ í• ê¹Œ?
> 
- ì´ëŸ° ì°¨ì´ë¡œ ì¸í•´ JPAì—ì„œëŠ” `ë‘ ê°ì²´ ì—°ê´€ê´€ê³„ ì¤‘ í•˜ë‚˜ë¥¼ ì •í•´ì„œ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•´ì•¼ í•˜ëŠ”ë° ì´ê²ƒì„ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ë¼ í•œë‹¤.

## 5.4.1 ì–‘ë°©í–¥ ë§¤í•‘ì˜ ê·œì¹™ : ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸

> ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ë§Œì´ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê´€ê´€ê³„ì™€ ë§¤í•‘ë˜ê³  ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬(ë“±ë¡, ìˆ˜ì •, ì‚­ì œ)í•  ìˆ˜ ìˆë‹¤.
ë°˜ë©´ì— ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì€ ì½ê¸°ë§Œ í•  ìˆ˜ ìˆë‹¤.
> 
- ì£¼ì¸ì€ mappedBy ì†ì„±ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ì£¼ì¸ì´ ì•„ë‹ˆë©´ mappedBy ì†ì„±ì„ ì‚¬ìš©í•´ì„œ ì†ì„±ì˜ ê°’ìœ¼ë¡œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì„ ì§€ì •í•´ì•¼ í•œë‹¤.

<aside>
ğŸ™Œ ê·¸ë ‡ë‹¤ë©´ Member.team, Team.members ë‘˜ ì¤‘ ì–´ë–¤ ê²ƒì„ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ìœ¼ë¡œ ì •í•´ì•¼ í• ê¹Œ?

</aside>

```java
public class Member{
		@ManyToOne
		@JoinColumn(name="TEAM_ID")
		private Team team;
}
public class Team{
		@OneToMany(mappedBy = "team")
		private List<Member> members = new ArrayList<>();
}
```

> ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì„ ì •í•œë‹¤ëŠ” ê²ƒì€ ì‚¬ì‹¤ ì™¸ë˜ í‚¤ ê´€ë¦¬ìë¥¼ ì„ íƒí•˜ëŠ” ê²ƒì´ë‹¤.
> 
- ë§Œì•½ íšŒì› ì—”í‹°í‹°ì— ìˆëŠ” Member.teamì„ ì£¼ì¸ìœ¼ë¡œ ì„ íƒí•˜ë©´ ìê¸° í…Œì´ë¸”ì— ìˆëŠ” ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•˜ë©´ ëœë‹¤.
- í•˜ì§€ë§Œ íŒ€ ì—”í‹°í‹°ì— ìˆëŠ” Team.membersë¥¼ ì£¼ì¸ìœ¼ë¡œ ì„ íƒí•˜ë©´ ë¬¼ë¦¬ì ìœ¼ë¡œ ì „í˜€ ë‹¤ë¥¸ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•´ì•¼ í•œë‹¤.

## 5.4.2 ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ê³³

> ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ê³³ìœ¼ë¡œ ì •í•´ì•¼ í•œë‹¤.
> 

ì—¬ê¸°ì„œëŠ” íšŒì› í…Œì´ë¸”ì´ ì™¸ë˜ í‚¤ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë¯€ë¡œ Member.teamì´ ì£¼ì¸ì´ ëœë‹¤.

ì£¼ì¸ì´ ì•„ë‹Œ Team.membersì—ëŠ” mappedBy=â€teamâ€ ì†ì„±ì„ ì‚¬ìš©í•´ì„œ ì£¼ì¸ì´ ì•„ë‹˜ì„ ì„¤ì •í•œë‹¤.

```java
public class Team{
		@OneToMany(mappedBy = "team") // ì—°ê´€ê´€ê³„ ì£¼ì¸ã„´ì¸ Member.team í•„ë“œë¥¼ ë§í•œë‹¤.
		private List<Member> members = new ArrayList<>();
}
```

ì •ë¦¬í•˜ë©´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ë§Œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê´€ê´€ê³„ì™€ ë§¤í•‘ë˜ê³  ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.

ì£¼ì¸ì´ ì•„ë‹Œ ë°˜ëŒ€í¸ì€ ì½ê¸°ë§Œ ê°€ëŠ¥í•˜ê³  ì™¸ë˜í‚¤ë¥¼ ë³€ê²½í•˜ì§€ëŠ” ëª»í•œë‹¤.

<aside>
ğŸ™Œ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì˜ ë‹¤ëŒ€ì¼, ì¼ëŒ€ë‹¤ ê´€ê³„ì—ì„œëŠ” í•­ìƒ ë‹¤ ìª½ì´ ì™¸ë˜ í‚¤ë¥¼ ê°€ì§„ë‹¤. ë‹¤ ìª½ì¸ @ManyToOneì€ í•­ìƒ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ë˜ë¯€ë¡œ mappedByë¥¼ ì„¤ì •í•  ìˆ˜ ì—†ë‹¤. ë”°ë¼ì„œ @ManyToOneì—ëŠ” mappedBy ì†ì„±ì´ ì—†ë‹¤.

</aside>

# 5.5 ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ ì €ì¥

```java
Team team1 = new Team("team1", "íŒ€1");
em.persist(team1);

Member member1 = new Member("member1", "íšŒì›1");
member1.setTeam(team1); // ì—°ê´€ê´€ê³„ ì„¤ì • member1 -> team1
em.persist(member1);

Member member2 = new Member("member2", "íšŒì›2");
member1.setTeam(team1); // ì—°ê´€ê´€ê³„ ì„¤ì • member2 -> team1
em.persist(member2);
```

ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•œë‹¤.

ë”°ë¼ì„œ ì£¼ì¸ì´ ì•„ë‹Œ ë°©í–¥ì€ ê°’ì„ ì„¤ì •í•˜ì§€ ì•Šì•„ë„ ë°ì´í„°ë² ì´ìŠ¤ ì™¸ë˜ í‚¤ ê°’ì´ ì •ìƒ ì…ë ¥ëœë‹¤.

```java
team1.getMembers().add(member1);
team1.getMembers().add(member2);
```

Team.membersëŠ” ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ì•„ë‹ˆë‹¤.

ì£¼ì¸ì´ ì•„ë‹Œ ê³³ì— ì…ë ¥ëœ ê°’ì€ ì™¸ë˜ í‚¤ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ ìœ„ì˜ ì½”ë“œëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•  ë•Œ ë¬´ì‹œëœë‹¤.

# 5.6 ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì˜ ì£¼ì˜ì 

> ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ ì„¤ì •í•˜ê³  ê°€ì¥ í”íˆ í•˜ëŠ” ì‹¤ìˆ˜ëŠ” ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì—ëŠ” ê°’ì„ ì…ë ¥í•˜ì§€ ì•Šê³ , ì£¼ì¸ì´ ì•„ë‹Œ ê³³ì—ë§Œ ê°’ì„ ì…ë ¥í•˜ëŠ” ê²ƒì´ë‹¤.
> 

```java
Member member1 = new Member("member1", "íšŒì›1");
em.persist(member1);

Member member2 = new Member("member2", "íšŒì›2");
em.persist(member2);

Team team1 = new Team("team1", "íŒ€1");
// ì£¼ì¸ì´ ì•„ë‹Œ ê³³ì—ì„œ ì—°ê´€ê´€ê³„ ì„¤ì •
team1.getMembers().add(member1);
team1.getMembers().add(member2);

em.persist(team1);
```

ìœ„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê³  íšŒì›ì„ ì¡°íšŒí•˜ë©´ team1ì´ ì•„ë‹Œ nullì´ ë‹´ê²¨ìˆëŠ”ë°, ì´ê²ƒì€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ì•„ë‹Œ ë°˜ëŒ€ìª½ì—ì„œ ì—°ê´€ê´€ê³„ë¥¼ ì €ì¥í•˜ë ¤ê³  í–ˆê¸° ë•Œë¬¸ì´ë‹¤.

## 5.6.1 ìˆœìˆ˜í•œ ê°ì²´ê¹Œì§€ ê³ ë ¤í•œ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„

> ê·¸ë ‡ë‹¤ë©´ ì •ë§ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì—ë§Œ ê°’ì„ ì €ì¥í•˜ê³  ì•„ë‹Œ ê³³ì—ëŠ” ê°’ì„ ì €ì¥í•˜ì§€ ì•Šì•„ë„ ë ê¹Œ?
> 

ì‚¬ì‹¤ì€ `ê°ì²´ ê´€ì ì—ì„œ ì–‘ìª½ ë°©í–¥ì— ëª¨ë‘ ê°’ì„ ì…ë ¥í•´ì£¼ëŠ” ê²ƒì´ ê°€ì¥ ì•ˆì „í•˜ë‹¤.`
ì–‘ìª½ ë°©í–¥ ëª¨ë‘ ê°’ì„ ì…ë ¥í•˜ì§€ ì•Šìœ¼ë©´ JPAë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ìˆœìˆ˜í•œ ê°ì²´ ìƒíƒœì—ì„œ ì‹¬ê°í•œ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ JPAë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ì—”í‹°í‹°ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤ê³  ê°€ì •í•´ë³´ì.

ORMì€ ê°ì²´ì™€ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ ë‘˜ ë‹¤ ì¤‘ìš”í•˜ë‹¤. ë°ì´í„°ë² ì´ìŠ¤ ë¿ë§Œ ì•„ë‹ˆë¼ ê°ì²´ë„ í•¨ê»˜ ê³ ë ¤í•´ì•¼ í•œë‹¤;.

```java
Team team1 = new Team("team1", "íŒ€1");
Member member1 = new Member("member1", "íšŒì›1");
Member member2 = new Member("member2", "íšŒì›2");

member1.setTeam(team1);
member2.setTeam(team1);

List<Member> members = team1.getMembers();
System.out.println("members.size = " + members.size());

// ê²°ê³¼ëŠ” member.size = 0
```

ë§ˆì§€ë§‰ ì¤„ì˜ ê²°ê³¼ëŠ” 0ì´ ë‚˜ì˜¨ë‹¤. ì´ê²ƒì€ ìš°ë¦¬ê°€ ê¸°ëŒ€í•˜ëŠ” ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì˜ ê²°ê³¼ê°€ ì•„ë‹ˆë‹¤.

ì–‘ìª½ ëª¨ë‘ ì„¤ì •í•œ ì½”ë“œë¥¼ ë³´ì

```java
Team team1 = new Team("team1", "íŒ€1");
Member member1 = new Member("member1", "íšŒì›1");
Member member2 = new Member("member2", "íšŒì›2");

member1.setTeam(team1);
team1.getMembers().add(member1);

member2.setTeam(team1);
team1.getMembers().add(member1);

List<Member> members = team1.getMembers();
System.out.println("members.size = " + members.size());

// ê²°ê³¼ëŠ” member.size = 2
```

ì–‘ìª½ ëª¨ë‘ ê´€ê³„ë¥¼ ì„¤ì •í•˜ê³  ê²°ê³¼ë„ ê¸°ëŒ€í•œ 2ê°€ ì¶œë ¥ëœë‹¤. ì´ë ‡ê²Œ ê°ì²´ê¹Œì§€ ê³ ë ¤í•˜ë©´ ì–‘ìª½ ë‹¤ ê´€ê³„ë¥¼ ë§ºì–´ì•¼ í•œë‹¤.

JPAë¥¼ ì‚¬ìš©í•´ì„œ ì™„ì„±í•œ ì˜ˆì œ

```java
Team team1 = new Team("team1", "íŒ€1");
em.persist(team1);

Member member1 = new Member("member1", "íšŒì›1");
Member member2 = new Member("member2", "íšŒì›2");

member1.setTeam(team1);
team1.getMembers().add(member1);
em.persist(member1);

member2.setTeam(team1);
team1.getMembers().add(member1);
em.persist(member2);
```

ì–‘ìª½ì— ì—°ê´€ê´€ê³„ë¥¼ ì„¤ì •í–ˆë‹¤. ë”°ë¼ì„œ ìˆœìˆ˜í•œ ê°ì²´ ìƒíƒœì—ì„œë„ ë™ì‘í•˜ë©°, í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë„ ì •ìƒ ì…ë ¥ëœë‹¤.

ë¬¼ë¡  ì™¸ë˜ í‚¤ì˜ ê°’ì€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì¸ [Member.team](http://Member.team) ê°’ì„ ì‚¬ìš©í•œë‹¤.

## 5.6.2 ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œ

ì–‘ë°©í–¥ ê´€ê³„ì—ì„œ ì•„ë˜ì˜ ì½”ë“œëŠ” í•˜ë‚˜ì¸ ê²ƒì²˜ëŸ¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•ˆì „í•˜ë¯€ë¡œ Member í´ë˜ìŠ¤ì˜ setTeam() ë©”ì„œë“œë¥¼ ë¦¬íŒ©í† ë§í•´ë³´ì.

```java
class Member{
		private Team team;
		
		public void setTeam(Team team){
				this.team = team;
				team.getMembers().add(this);
		}
}
```

ì´ë ‡ê²Œ ë¦¬íŒ©í† ë§í•˜ë©´ ì‹¤ìˆ˜ë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‹¤.

```java
Team team1 = new Team("team1", "íŒ€1");
em.persist(team1);

Member member1 = new Member("member1", "íšŒì›1");
Member member2 = new Member("member2", "íšŒì›2");

member1.setTeam(team1);
em.persist(member1);

member2.setTeam(team1);
em.persist(member2);
```

> ì´ë ‡ê²Œ í•œ ë²ˆì— ì–‘ë°©í–¥ ê´€ê³„ë¥¼ ì„¤ì •í•˜ëŠ” ë©”ì„œë“œë¥¼ ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œë¼ê³  í•œë‹¤.
> 

## 5.6.3 ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œ ì‘ì„± ì‹œ ì£¼ì˜ì‚¬í•­

ì‚¬ì‹¤ setTeam() ë©”ì„œë“œì—ëŠ” ë²„ê·¸ê°€ ìˆë‹¤.

```java
member1.setTeam(teamA);
member1.setTeam(teamB);
Member findMember = teamA.getMember(); // member1ì€ ì—¬ì „íˆ ì¡°íšŒëœë‹¤.
```

teamBë¡œ ë³€ê²½í•  ë•Œ teamA â†’ member1 ê´€ê³„ë¥¼ ì œê±°í•˜ì§€ ì•Šì•˜ë‹¤.

ë”°ë¼ì„œ ì—°ê´€ê´€ê³„ë¥¼ ë³€ê²½í•  ë•ŒëŠ” ê¸°ì¡´ íŒ€ì´ ìˆìœ¼ë©´ ê¸°ì¡´ íŒ€ê³¼ íšŒì›ì˜ ì—°ê´€ê´€ê³„ë¥¼ ì‚­ì œí•˜ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í•´ì•¼ í•œë‹¤.

```java
public void setTeam(Team team){
		
		if(this.team != null) this.team.getMembers().remove(this);
		
		this.team = team;
		team.getMembers().add(this);
}
```

> ì •ë¦¬í•˜ìë©´ ê°ì²´ì—ì„œ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ë¡œì§ì„ ê²¬ê³ í•˜ê²Œ ì‘ì„±í•´ì•¼ í•œë‹¤.
> 

# 5.7 ì •ë¦¬

- ë‹¨ë°©í–¥ ë§¤í•‘ë§Œìœ¼ë¡œ í…Œì´ë¸”ê³¼ ê°ì²´ì˜ ì—°ê´€ê´€ê³„ ë§¤í•‘ì€ ì´ë¯¸ ì™„ë£Œë˜ì—ˆë‹¤.
- ë‹¨ë°©í–¥ì„ ì–‘ë°©í–¥ìœ¼ë¡œ ë§Œë“¤ë©´ ë°˜ëŒ€ë°©í–¥ìœ¼ë¡œ ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ ê¸°ëŠ¥ì´ ì¶”ê°€ëœë‹¤.
- ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ ë§¤í•‘í•˜ë ¤ë©´ ê°ì²´ì—ì„œ ì–‘ìª½ ë°©í–¥ì„ ëª¨ë‘ ê´€ë¦¬í•´ì•¼í•œë‹¤.